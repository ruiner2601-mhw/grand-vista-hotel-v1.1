<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guest Check-In | Grand Vista Hotel</title>
  <link rel="stylesheet" href="style.css">

  <style>
    a { text-decoration: none; color: inherit; }
    .checkin-box {
      max-width: 500px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 12px;
      border: 2px solid #E8D7A9;
      box-shadow: 0 4px 20px rgba(212,175,55,0.15);
      text-align: center;
    }
  </style>
</head>

<body>

  <header class="gv-header">
    <img src="V(1).png" alt="Grand Vista Hotel Logo" class="gv-logo">
    <h1>Guest Check-In</h1>
    <p>Please enter your information below</p>
  </header>

  <div class="checkin-box">
    <input type="text" id="guestName" placeholder="Enter your full name">
    <input type="password" id="guestPasscode" placeholder="Enter a 4-digit passcode">
    <button class="btn" onclick="checkInGuest()">Continue</button>
  </div>

  <footer>
    <p>&copy; 2025 Grand Vista Hotel</p>
  </footer>

<script>
/* --------------------------------------
   RANDOMIZATION HELPERS
--------------------------------------- */

// Random room number 1–200
function generateRandomRoom() {
  return Math.floor(Math.random() * 200) + 1;
}

// Random true/false
function randomBool() {
  return Math.random() < 0.5;
}

// Random hospitality-style notes
function randomNote() {
  const notes = [
    "Prefers high floor",
    "Traveling with family",
    "Requests extra towels",
    "Allergic to feathers",
    "Celebrating anniversary",
    "Celebrating birthday",
    "Needs ADA accessible room",
    "Requests quiet room",
    "Late arrival expected",
    "Early arrival expected",
    "Prefers extra pillows",
    "Hypoallergenic bedding requested",
    "Enjoys pool view rooms"
  ];
  return notes[Math.floor(Math.random() * notes.length)];
}

/* --------------------------------------
   MAIN CHECK-IN / LOGIN LOGIC
--------------------------------------- */

function checkInGuest() {
  const name = document.getElementById("guestName").value.trim();
  const passcode = document.getElementById("guestPasscode").value.trim();

  if (!name || !passcode) {
    alert("Please enter your name and passcode.");
    return;
  }

  if (passcode.length !== 4 || isNaN(passcode)) {
    alert("Passcode must be a 4-digit number.");
    return;
  }

  let guests = JSON.parse(localStorage.getItem("guests")) || [];

  /* --------------------------------------
     CLEAN SAMPLE GUEST DATA (fix undefined)
  --------------------------------------- */
  guests = guests.map(g => ({
    ...g,
    guestsInRoom: g.guestsInRoom || Math.floor(Math.random() * 4) + 1
  }));

  /* --------------------------------------
     STEP 1 — CHECK IF GUEST EXISTS (LOGIN)
  --------------------------------------- */
  let existingGuest = guests.find(
    g => g.name.toLowerCase() === name.toLowerCase() &&
         g.passcode === passcode
  );

  if (existingGuest) {
    // Upgrade status for existing guest
    existingGuest.roomStatus = "Checked In";

    if (!existingGuest.key) {
      existingGuest.key = `GV-${existingGuest.room}-${existingGuest.passcode}`;
    }

    existingGuest.keyStatus = "Active";

    // Save updated guest list
    guests = guests.map(g =>
      g.name.toLowerCase() === existingGuest.name.toLowerCase() &&
      g.passcode === existingGuest.passcode
        ? existingGuest
        : g
    );

    localStorage.setItem("guests", JSON.stringify(guests));
    localStorage.setItem("currentGuest", JSON.stringify(existingGuest));

    window.location.href = "guest_dashboard.html";
    return;
  }

  /* --------------------------------------
     STEP 2 — NEW GUEST CREATION
  --------------------------------------- */

  const room = generateRandomRoom();
  const vip = randomBool();
  const hasPet = randomBool();
  const earlyCheckInRequested = randomBool();
  const notes = randomNote();
  const guestsInRoom = Math.floor(Math.random() * 4) + 1;

  const today = new Date().toISOString().split("T")[0];

  const newGuest = {
    name,
    passcode,
    room,
    guestsInRoom,
    roomStatus: "Checked In",
    arrivalDate: today,
    departureDate: "TBD",
    key: `GV-${room}-${passcode}`,
    keyStatus: "Active",
    parkingInfo: "No Vehicle",
    billing: "Pending",
    creditCard: { type: "Visa", lastFour: "0000" },

    // randomized features
    vip,
    hasPet,
    earlyCheckInRequested,
    notes,

    requests: []
  };

  guests.push(newGuest);

  // Save to localStorage
  localStorage.setItem("guests", JSON.stringify(guests));
  localStorage.setItem("currentGuest", JSON.stringify(newGuest));

  // Redirect
  window.location.href = "guest_dashboard.html";
}
</script>

</body>
</html>
