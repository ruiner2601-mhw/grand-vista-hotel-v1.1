<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Room Service Request | Grand Vista Hotel</title>
  <link rel="stylesheet" href="style.css">

  <style>
    .request-box {
      max-width: 500px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 12px;
      border: 2px solid #E8D7A9;
      box-shadow: 0 4px 20px rgba(212,175,55,0.15);
      text-align: center;
    }

    textarea {
      width: 90%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d4af37;
      margin-top: 1rem;
      resize: vertical;
    }

    select {
      width: 90%;
      padding: 10px;
      border: 1px solid #d4af37;
      border-radius: 6px;
      margin-top: 1rem;
      background-color: #fff;
    }

    .confirmation {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 20px;
      display: none;
      color: #155724;
    }
  </style>
</head>

<body>

<header class="gv-header">
  <img src="V(1).png" alt="Logo" class="gv-logo">
  <h1>Room Service Request</h1>
  <p>How may we assist you today?</p>
</header>

<div class="request-box">
  <h2>Submit a Request</h2>

  <select id="requestType" onchange="toggleOtherBox()">
    <option value="">Select an option...</option>
    <option value="Towels">Towels</option>
    <option value="Toiletries">Toiletries</option>
    <option value="Extra bedding">Extra bedding</option>
    <option value="Room cleaning">Room cleaning</option>
    <option value="Food delivery">Food delivery</option>
    <option value="Technical assistance">Technical assistance</option>
    <option value="Wake-up call">Wake-up call</option>
    <option value="Other">Other</option>
  </select>

  <textarea id="otherText" placeholder="Please describe your request..."
            style="display:none;"></textarea>

  <button class="btn" style="margin-top:1rem;" onclick="submitRequest()">
    Submit Request
  </button>

  <div id="confirmation" class="confirmation">
    Request submitted successfully!
  </div>

  <a href="guest_dashboard.html">
    <button class="btn" style="margin-top:1rem;">Back to Dashboard</button>
  </a>
</div>

<footer>
  <p>&copy; 2025 Grand Vista Hotel</p>
</footer>

<script>
function toggleOtherBox() {
  const type = document.getElementById("requestType").value;
  const other = document.getElementById("otherText");
  other.style.display = (type === "Other") ? "block" : "none";
}

function submitRequest() {
  const type = document.getElementById("requestType").value;
  const other = document.getElementById("otherText").value.trim();

  if (!type) {
    alert("Please choose a request type.");
    return;
  }

  const text = (type === "Other") ? other : type;
  if (type === "Other" && !other) {
    alert("Please describe your request.");
    return;
  }

  let guests = JSON.parse(localStorage.getItem("guests")) || [];
  let guest = JSON.parse(localStorage.getItem("currentGuest"));
  if (!guest) {
    alert("No guest logged in.");
    return;
  }

  // Build request object in the CORRECT format
  const newRequest = {
    text,
    date: new Date().toLocaleString(),
    status: "pending",
    createdAt: Date.now(),
    completedAt: null
  };

  // Add request to guest
  guest.requests = guest.requests || [];
  guest.requests.push(newRequest);

  // Update guest list
  guests = guests.map(g =>
    g.name.toLowerCase() === guest.name.toLowerCase() &&
    g.passcode === guest.passcode
      ? guest
      : g
  );

  // Save updates
  localStorage.setItem("guests", JSON.stringify(guests));
  localStorage.setItem("currentGuest", JSON.stringify(guest));

  // Show confirmation
  document.getElementById("confirmation").style.display = "block";

  // Hide confirmation after 2 seconds
  setTimeout(() => {
    document.getElementById("confirmation").style.display = "none";
  }, 2000);

  // Clear fields
  document.getElementById("requestType").value = "";
  document.getElementById("otherText").value = "";
  document.getElementById("otherText").style.display = "none";
}
</script>

</body>
</html>
