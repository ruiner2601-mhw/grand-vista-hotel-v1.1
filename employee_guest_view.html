<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Employee Guest Management | Grand Vista Hotel</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* --- Table Styling --- */
    table {
      width: 95%;
      margin: 2rem auto;
      border-collapse: collapse;
      background-color: #fff;
      color: #000;
      border: 2px solid #d4af37;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(212, 175, 55, 0.2);
    }

    th, td {
      border-bottom: 1px solid #e6d8a2;
      padding: 0.75rem 1rem;
      text-align: left;
    }

    th {
      background-color: #f9f6ed;
      color: #000;
    }

    tr:hover {
      background-color: #fff8dc;
    }

    .details {
      display: none;
      background-color: #fefcf6;
    }

    .details td {
      border-top: 1px solid #d4af37;
      padding: 1rem 2rem;
    }

    button.view-btn {
      background-color: #d4af37;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button.view-btn:hover {
      background-color: #e5c864;
    }

    .toggle-btn {
      background: none;
      border: none;
      color: #d4af37;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.9rem;
      margin-left: 0.5rem;
    }

    h2 {
      text-align: center;
      margin-top: 1.5rem;
    }
  </style>
</head>
<body>
  <header class="gv-header">
    <img src="V.png" alt="Grand Vista Hotel Logo" style="height:100px; margin-bottom:1rem;">
    <h1>Guest Management Board</h1>
    <p>View guest details, requests, and stay information</p>
  </header>

  <main>
    <h2>Current Guests</h2>
    <table id="guestTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Room</th>
          <th>Arrival</th>
          <th>Departure</th>
          <th>Requests</th>
          <th>Key Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="guestTableBody"></tbody>
    </table>
  </main>

  <footer>
    <p>&copy; 2025 Grand Vista Hotel</p>
  </footer>

  <script>
    // Generate random departure date within 7 days
    function randomDepartureDate() {
      const today = new Date();
      const offset = Math.floor(Math.random() * 7) + 1;
      const dep = new Date(today);
      dep.setDate(today.getDate() + offset);
      return dep.toISOString().split("T")[0];
    }

    // Load and enrich guests data
    let guests = JSON.parse(localStorage.getItem("guests")) || [];
    guests = guests.map(g => {
      if (!g.arrivalDate) g.arrivalDate = new Date().toISOString().split("T")[0];
      if (!g.departureDate) g.departureDate = randomDepartureDate();
      if (!g.keyStatus) g.keyStatus = "Active";
      if (!g.parkingInfo) g.parkingInfo = "1 Vehicle - Standard Parking";
      if (!g.billing) g.billing = "Paid in Full";
      if (!g.requests) g.requests = [];
      return g;
    });
    localStorage.setItem("guests", JSON.stringify(guests));

    const tableBody = document.getElementById("guestTableBody");

    // Helper: Mask string for display
    function maskString(str) {
      if (!str) return "N/A";
      return "****" + str.slice(-3);
    }

    function renderGuests() {
      tableBody.innerHTML = "";
      guests.forEach((guest, index) => {
        const requestCount = guest.requests ? guest.requests.length : 0;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${guest.name}</td>
          <td>${guest.room}</td>
          <td>${guest.arrivalDate}</td>
          <td>${guest.departureDate}</td>
          <td>${requestCount}</td>
          <td>${guest.keyStatus}</td>
          <td><button class="view-btn" onclick="toggleDetails(${index})">View Details</button></td>
        `;

        const detailRow = document.createElement("tr");
        detailRow.className = "details";
        detailRow.innerHTML = `
          <td colspan="7">
            <strong>Passcode:</strong> 
            <span id="pass-${index}" class="masked">${maskString(guest.passcode)}</span>
            <button class="toggle-btn" onclick="toggleMask(${index}, 'pass')">Show</button><br><br>
            
            <strong>Digital Key:</strong> 
            <span id="key-${index}" class="masked">${maskString(guest.key)}</span>
            <button class="toggle-btn" onclick="toggleMask(${index}, 'key')">Show</button><br><br>

            <strong>Service Requests:</strong>
            <ul>
              ${guest.requests.length > 0 ? guest.requests.map(r => `<li>${r}</li>`).join("") : "<li>No pending requests</li>"}
            </ul>
            <strong>Parking Info:</strong> ${guest.parkingInfo}<br>
            <strong>Billing:</strong> ${guest.billing}
          </td>
        `;

        tableBody.appendChild(row);
        tableBody.appendChild(detailRow);
      });
    }

    function toggleDetails(index) {
      const detailRows = document.querySelectorAll(".details");
      detailRows[index].style.display =
        detailRows[index].style.display === "table-row" ? "none" : "table-row";
    }

    function toggleMask(index, type) {
      const span = document.getElementById(`${type}-${index}`);
      const guest = guests[index];
      const isMasked = span.textContent.startsWith("****");

      if (isMasked) {
        span.textContent = type === "pass" ? guest.passcode : guest.key;
      } else {
        span.textContent = maskString(type === "pass" ? guest.passcode : guest.key);
      }
    }

    renderGuests();
  </script>
</body>
</html>
