<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Employee Guest View â€“ Grand Vista Hotel</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="gv-header">
    <h1>Guest Management Board</h1>
  </header>

  <main class="kanban-board">
    <section class="kanban-column" id="checkedInColumn">
      <h2>Checked-In Guests</h2>
      <div class="kanban-list" id="guestList"></div>
    </section>

    <section class="kanban-column" id="pendingColumn">
      <h2>Pending Requests</h2>
      <div class="kanban-list" id="pendingList"></div>
    </section>

    <section class="kanban-column" id="completedColumn">
      <h2>Completed Requests</h2>
      <div class="kanban-list" id="completedList"></div>
    </section>
  </main>

  <div class="center-btn">
    <button onclick="window.location.href='employee_index.html'">Back to Dashboard</button>
  </div>

  <script>
    const guestList = document.getElementById('guestList');
    const pendingList = document.getElementById('pendingList');
    const completedList = document.getElementById('completedList');

    let guests = JSON.parse(localStorage.getItem('guests') || '[]');
    let requests = JSON.parse(localStorage.getItem('requests') || '[]');
    let completed = JSON.parse(localStorage.getItem('completedRequests') || '[]');

    function ensureGuestCount(guest) {
      if (!guest.guestCount) guest.guestCount = Math.floor(Math.random() * 4) + 1;
      return guest.guestCount;
    }

    function createGuestCard(guest, category = 'normal') {
      const guestDiv = document.createElement('div');
      guestDiv.className = 'guest-card';
      const guestCount = ensureGuestCount(guest);

      guestDiv.innerHTML = `
        <h3>${guest.name}</h3>
        <p><strong>Room:</strong> ${guest.room}</p>
        <p><strong>Guests in Room:</strong> ${guestCount}</p>
        <p><strong>Passcode:</strong> ${guest.passcode}</p>
        <p><strong>Digital Key:</strong> ${guest.key}</p>
      `;

      const guestRequests = requests.filter(r => r.guest === guest.name);

      if (category === 'pending' && guestRequests.length > 0) {
        guestDiv.innerHTML += `<h4>Requests:</h4>`;
        const ul = document.createElement('ul');
        guestRequests.forEach(r => {
          const li = document.createElement('li');
          li.textContent = `${r.time}: ${r.request}`;
          ul.appendChild(li);
        });
        guestDiv.appendChild(ul);

        // Add "Mark as Completed" button
        const doneBtn = document.createElement('button');
        doneBtn.textContent = 'Mark as Completed';
        doneBtn.addEventListener('click', () => markAsCompleted(guest, guestDiv));
        guestDiv.appendChild(doneBtn);
      }

      return guestDiv;
    }

    function markAsCompleted(guest, cardElement) {
      // Remove requests for this guest and move to completed column
      requests = requests.filter(r => r.guest !== guest.name);
      completed.push(guest);
      localStorage.setItem('requests', JSON.stringify(requests));
      localStorage.setItem('completedRequests', JSON.stringify(completed));

      // Move visually
      pendingList.removeChild(cardElement);
      cardElement.querySelector('button')?.remove();
      completedList.appendChild(cardElement);
    }

    function loadGuests() {
      guestList.innerHTML = '';
      pendingList.innerHTML = '';
      completedList.innerHTML = '';

      if (guests.length === 0) {
        guestList.innerHTML = '<p>No guests currently checked in.</p>';
        return;
      }

      guests.forEach(guest => {
        const guestRequests = requests.filter(r => r.guest === guest.name);
        const isCompleted = completed.some(c => c.name === guest.name);

        if (isCompleted) {
          completedList.appendChild(createGuestCard(guest, 'completed'));
        } else if (guestRequests.length > 0) {
          pendingList.appendChild(createGuestCard(guest, 'pending'));
        } else {
          guestList.appendChild(createGuestCard(guest, 'normal'));
        }
      });

      localStorage.setItem('guests', JSON.stringify(guests));
    }

    loadGuests();
  </script>
</body>
</html>
