<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guest Dashboard | Grand Vista Hotel</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .dashboard-card {
      max-width: 600px;
      background-color: #fff;
      color: #000;
      margin: 2rem auto;
      padding: 2rem;
      border: 2px solid #d4af37;
      border-radius: 10px;
      box-shadow: 0 0 12px rgba(212, 175, 55, 0.25);
    }
    .dashboard-card h2 {
      color: #d4af37;
      text-align: center;
      margin-bottom: 1rem;
    }
    .dashboard-card p {
      margin: 0.5rem 0;
    }
    textarea {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #d4af37;
      border-radius: 5px;
      resize: vertical;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    ul li {
      background: #fff8dc;
      border: 1px solid #d4af37;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      margin-top: 0.5rem;
    }
    h4 {
      margin-top: 1.5rem;
      color: #000;
    }
  </style>
</head>
<body>
  <header class="gv-header">
    <img src="V.png" alt="Grand Vista Hotel Logo" style="height:100px; margin-bottom:1rem;">
    <h1>Guest Dashboard</h1>
    <p>Your room details and services</p>
  </header>

  <main>
    <section class="dashboard-card" id="dashboard">
      <h2>Welcome, Guest</h2>
      <p><strong>Room Number:</strong> <span id="roomNumber"></span></p>
      <p><strong>Guests in Room:</strong> <span id="guestCount"></span></p>
      <p><strong>Arrival:</strong> <span id="arrivalDate"></span></p>
      <p><strong>Departure:</strong> <span id="departureDate"></span></p>
      <p><strong>Digital Key:</strong> <span id="digitalKey"></span></p>

      <hr>

      <h3>Room Service Requests</h3>
      <textarea id="requestText" placeholder="Enter your request (e.g., extra towels, breakfast, cleaning)"></textarea>
      <button onclick="addServiceRequest()">Submit Request</button>

      <h4>Pending Requests (Newest First):</h4>
      <ul id="requestList"></ul>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Grand Vista Hotel</p>
  </footer>

  <script>
    function randomDepartureDate() {
      const today = new Date();
      const offset = Math.floor(Math.random() * 7) + 1;
      const dep = new Date(today);
      dep.setDate(today.getDate() + offset);
      return dep.toISOString().split("T")[0];
    }

    // Load guest info
    let currentGuest = JSON.parse(localStorage.getItem("currentGuest"));
    if (!currentGuest) {
      alert("No guest found. Please check in first.");
      window.location.href = "guest_information.html";
    }

    if (!currentGuest.arrivalDate) currentGuest.arrivalDate = new Date().toISOString().split("T")[0];
    if (!currentGuest.departureDate) currentGuest.departureDate = randomDepartureDate();
    if (!currentGuest.requests) currentGuest.requests = [];

    // Sync to master guest list
    let guests = JSON.parse(localStorage.getItem("guests")) || [];
    const gIndex = guests.findIndex(g => g.name === currentGuest.name && g.passcode === currentGuest.passcode);
    if (gIndex !== -1) {
      guests[gIndex] = currentGuest;
    } else {
      guests.push(currentGuest);
    }
    localStorage.setItem("guests", JSON.stringify(guests));
    localStorage.setItem("currentGuest", JSON.stringify(currentGuest));

    // Display guest info
    document.getElementById("roomNumber").textContent = currentGuest.room;
    document.getElementById("guestCount").textContent = currentGuest.guestsInRoom || "N/A";
    document.getElementById("arrivalDate").textContent = currentGuest.arrivalDate;
    document.getElementById("departureDate").textContent = currentGuest.departureDate;
    document.getElementById("digitalKey").textContent = currentGuest.key;

    // Render requests (newest first)
    function renderRequests() {
      const list = document.getElementById("requestList");
      list.innerHTML = "";
      if (!currentGuest.requests || currentGuest.requests.length === 0) {
        list.innerHTML = "<li>No pending requests</li>";
        return;
      }

      // Show newest first
      const sortedRequests = [...currentGuest.requests].reverse();
      sortedRequests.forEach(r => {
        const li = document.createElement("li");
        li.textContent = r;
        list.appendChild(li);
      });
    }

    renderRequests();

    // Add service request
    function addServiceRequest() {
      const requestInput = document.getElementById("requestText");
      const requestText = requestInput.value.trim();
      if (!requestText) return alert("Please enter a request first.");

      // Reload data
      let currentGuest = JSON.parse(localStorage.getItem("currentGuest"));
      let guests = JSON.parse(localStorage.getItem("guests")) || [];

      // Add to both current guest and master guest list
      if (!currentGuest.requests) currentGuest.requests = [];
      currentGuest.requests.push(requestText);

      const guestIndex = guests.findIndex(g => g.name === currentGuest.name && g.passcode === currentGuest.passcode);
      if (guestIndex !== -1) {
        if (!guests[guestIndex].requests) guests[guestIndex].requests = [];
        guests[guestIndex].requests.push(requestText);
      }

      // Save updates
      localStorage.setItem("currentGuest", JSON.stringify(currentGuest));
      localStorage.setItem("guests", JSON.stringify(guests));

      // Refresh UI
      requestInput.value = "";
      renderRequests();
      alert("Request submitted successfully!");
    }
  </script>
</body>
</html>
